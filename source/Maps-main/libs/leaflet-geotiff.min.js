/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/leaflet-geotiff-2@1.1.0/dist/leaflet-geotiff.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("geotiff/dist-browser/geotiff")):"function"==typeof define&&define.amd?define(["geotiff/dist-browser/geotiff"],e):e((t=t||self).GeoTIFF)}(this,(function(t){"use strict";try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(t){window.ImageData=function(){var t=[].concat(Array.prototype.slice.call(arguments)),e=void 0;if(t.length<2)throw new TypeError('Failed to construct "ImageData": 2 arguments required, but only '+t.length+" present.");if(t.length>2){if(!((e=t.shift())instanceof Uint8ClampedArray))throw new TypeError('Failed to construct "ImageData": parameter 1 is not of type "Uint8ClampedArray"');if(e.length!==4*t[0]*t[1])throw new Error('Failed to construct "ImageData": The input data byte length is not a multiple of (4 * width * height)')}var i=t[0],a=t[1],s=document.createElement("canvas").getContext("2d").createImageData(i,a);return e&&s.data.set(e),s}}L.LeafletGeotiff=L.ImageOverlay.extend({options:{arrayBuffer:null,arrowSize:20,band:0,image:0,renderer:null,rBand:0,gBand:1,bBand:2,alphaBand:0,transpValue:0,pane:"overlayPane",onError:null,sourceFunction:null,noDataValue:void 0,noDataKey:void 0,useWorker:!1},initialize(e,i){if(void 0===t)throw new Error("GeoTIFF not defined");this._url=e,this.raster={},this.sourceFunction=t.fromUrl,this._blockSize=65536,this.x_min=null,this.x_max=null,this.y_min=null,this.y_max=null,this.min=null,this.max=null,L.Util.setOptions(this,i),this.options.bounds&&(this._rasterBounds=L.latLngBounds(i.bounds)),this.options.renderer&&this.options.renderer.setParent(this),this.options.sourceFunction&&(this.sourceFunction=this.options.sourceFunction),this.options.blockSize&&(this._blockSize=this.options.blockSize),this._getData()},setURL(t){this._url=t,this._getData()},onAdd(t){this._map=t,this._image||this._initImage(),this._image.style.opacity=this.options.opacity||1,t._panes[this.options.pane].appendChild(this._image),t.on("moveend",this._reset,this),this.options.clearBeforeMove&&t.on("movestart",this._moveStart,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove(t){t.getPanes()[this.options.pane].removeChild(this._image),t.off("moveend",this._reset,this),this.options.clearBeforeMove&&t.off("movestart",this._moveStart,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},async _getData(){let e;return e=this.sourceFunction!==t.fromArrayBuffer?await this.sourceFunction(this._url,{blockSize:this._blockSize}).catch((t=>{if(!this.options.onError)return console.error(`Failed to load from url or blob ${this._url}`,t),!1;this.options.onError(t)})):await t.fromArrayBuffer(this.options.arrayBuffer,{blockSize:this._blockSize}).catch((t=>{if(!this.options.onError)return console.error(`Failed to load from array buffer ${this._url}`,t),!1;this.options.onError(t)})),this._processTIFF(e),!0},async _processTIFF(t){if(this.tiff=t,await this.setBand(this.options.band).catch((t=>{console.error("this.setBand threw error",t)})),!this.options.bounds){const t=await this.tiff.getImage(this.options.image).catch((t=>{console.error("this.tiff.getImage threw error",t)}));await t.getFileDirectory();try{const e=t.getBoundingBox();this.x_min=e[0],this.x_max=e[2],this.y_min=e[1],this.y_max=e[3]}catch(t){console.debug("No bounds supplied, and unable to parse bounding box from metadata."),this.options.onError&&this.options.onError(t)}if(this.options.noDataKey&&(this.options.noDataValue=this.getDescendantProp(t,this.options.noDataKey)),this._rasterBounds=L.latLngBounds([[this.y_min,this.x_min],[this.y_max,this.x_max]]),this._reset(),window.Worker&&this.options.useWorker){const t=new Blob(["onmessage = function(e){let data = e.data.data; let noDataValue = e.data.noDataValue; let min = data.filter(val=> val !== noDataValue).reduce((a,b)=>Math.min(a,b)); let max = data.filter(val => val !== noDataValue).reduce((a,b)=>Math.max(a,b)); postMessage({min:min, max:max});}"],{type:"application/javascript"}),e=new Worker(URL.createObjectURL(t));e.onmessage=t=>{this.min=t.data.min,this.max=t.data.max,console.log("worker terminated",t),e.terminate()},e.postMessage({data:this.raster.data[0],noDataValue:this.options.noDataValue})}else this.min=this.raster.data[0].reduce(((t,e)=>e===this.options.noDataValue?t:Math.min(t,e))),this.max=this.raster.data[0].reduce(((t,e)=>e==this.options.noDataValue?t:Math.max(t,e)))}},async setBand(t){this.options.band=t;const e=await this.tiff.getImage(this.options.image).catch((t=>{console.error("this.tiff.getImage threw error",t)})),i=await e.readRasters({samples:this.options.samples}).catch((t=>{console.error("image.readRasters threw error",t)})),a=i[this.options.rBand],s=i[this.options.gBand],o=i[this.options.bBand],r=this.options.transpValue?i[this.options.alphaBand].map((t=>t==this.options.transpValue?0:255)):i[this.options.alphaBand];return this.raster.data=[a,s,o,r].filter((function(t){return t})),this.raster.width=e.getWidth(),this.raster.height=e.getHeight(),this._reset(),!0},getRasterArray(){return this.raster.data},getRasterCols(){return this.raster.width},getRasterRows(){return this.raster.height},getBounds(){return this._rasterBounds},getMinMax(){return{min:this.min,max:this.max}},getValueAtLatLng(t,e){try{var i=Math.floor(this.raster.width*(e-this._rasterBounds._southWest.lng)/(this._rasterBounds._northEast.lng-this._rasterBounds._southWest.lng)),a=this.raster.height-Math.ceil(this.raster.height*(t-this._rasterBounds._southWest.lat)/(this._rasterBounds._northEast.lat-this._rasterBounds._southWest.lat));if(i<0||i>this.raster.width||a<0||a>this.raster.height)return null;const s=a*this.raster.width+i,o=this.raster.data[0][s];if(void 0===this.options.noDataValue)return o;return o!==parseInt(this.options.noDataValue)?o:null}catch(t){return}},_animateZoom(t){if(L.version>="1.0"){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),t.zoom,t.center).min;L.DomUtil.setTransform(this._image,i,e)}else{e=this._map.getZoomScale(t.zoom);var a=this._map.getBounds().getNorthWest(),s=this._map.getBounds().getSouthEast(),o=this._map._latLngToNewLayerPoint(a,t.zoom,t.center);this._map._latLngToNewLayerPoint(s,t.zoom,t.center)._subtract(o);this._image.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(o)+" scale("+e+") "}},_moveStart(){this._image.style.display="none"},_reset(){if(this.hasOwnProperty("_map")&&this._map&&this._rasterBounds){var t=this._map.latLngToLayerPoint(this._map.getBounds().getNorthWest()),e=this._map.latLngToLayerPoint(this._map.getBounds().getSouthEast())._subtract(t);L.DomUtil.setPosition(this._image,t),this._image.style.width=e.x+"px",this._image.style.height=e.y+"px",this._drawImage(),this._image.style.display="block"}},setClip(t){this.options.clip=t,this._reset()},_getPixelByLatLng(t){var e=this._map.latLngToLayerPoint(this._map.getBounds().getNorthWest()),i=this._map.latLngToLayerPoint(t);return L.point(i.x-e.x,i.y-e.y)},_clipMaskToPixelPoints(t){if(this.options.clip){var e=this._map.latLngToLayerPoint(this._map.getBounds().getNorthWest()),i=[];const r=this.options.clip[t];for(var a=0;a<r.length;a++){var s=this._map.latLngToLayerPoint(r[a]),o=L.point(s.x-e.x,s.y-e.y);i.push(o)}this._pixelClipPoints=i}else this._pixelClipPoints=void 0},_drawImage(){if(this.raster.hasOwnProperty("data")){var t,e,i={},a=this._map.latLngToLayerPoint(this._map.getBounds().getNorthWest()),s=this._map.latLngToLayerPoint(this._map.getBounds().getSouthEast())._subtract(a);if(i.rasterPixelBounds=L.bounds(this._map.latLngToContainerPoint(this._rasterBounds.getNorthWest()),this._map.latLngToContainerPoint(this._rasterBounds.getSouthEast())),i.rasterPixelBounds.max.x=parseInt(i.rasterPixelBounds.max.x),i.rasterPixelBounds.min.x=parseInt(i.rasterPixelBounds.min.x),i.rasterPixelBounds.max.y=parseInt(i.rasterPixelBounds.max.y),i.rasterPixelBounds.min.y=parseInt(i.rasterPixelBounds.min.y),i.xStart=i.rasterPixelBounds.min.x>0?i.rasterPixelBounds.min.x:0,i.xFinish=i.rasterPixelBounds.max.x<s.x?i.rasterPixelBounds.max.x:s.x,i.yStart=i.rasterPixelBounds.min.y>0?i.rasterPixelBounds.min.y:0,i.yFinish=i.rasterPixelBounds.max.y<s.y?i.rasterPixelBounds.max.y:s.y,i.plotWidth=i.xFinish-i.xStart,i.plotHeight=i.yFinish-i.yStart,i.plotWidth<=0||i.plotHeight<=0)return(t=document.createElement("canvas")).width=s.x,t.height=s.y,(e=t.getContext("2d")).clearRect(0,0,t.width,t.height),void(this._image.src=t.toDataURL());i.xOrigin=this._map.getPixelBounds().min.x+i.xStart,i.yOrigin=this._map.getPixelBounds().min.y+i.yStart,i.lngSpan=(this._rasterBounds._northEast.lng-this._rasterBounds._southWest.lng)/this.raster.width,i.latSpan=(this._rasterBounds._northEast.lat-this._rasterBounds._southWest.lat)/this.raster.height,(t=document.createElement("canvas")).width=s.x,t.height=s.y,(e=t.getContext("2d")).clearRect(0,0,t.width,t.height),this.options.renderer.render(this.raster,t,e,i),this._image.src=String(t.toDataURL())}},createSubmask(t,e,i){var a=document.createElement("canvas");a.width=t.x,a.height=t.y;var s=a.getContext("2d");s.clearRect(0,0,a.width,a.height);for(var o=0;o<i.length;o++){var r=i[o];o>0&&(s.globalCompositeOperation="destination-out"),s.beginPath();for(var n=0;n<r.length;n++){var h=this._getPixelByLatLng(r[n]);s.lineTo(h.x,h.y)}s.fill()}return a},createMask(t,e){var i=document.createElement("canvas");i.width=t.x,i.height=t.y;var a=i.getContext("2d");a.clearRect(0,0,i.width,i.height),a.fillRect(e.xStart,e.yStart,e.plotWidth,e.plotHeight);const s=this.options.clip;if(s){a.globalCompositeOperation="destination-out";for(var o=0;o<s.length;o++){var r=this.createSubmask(t,e,s[o]);a.drawImage(r,0,0)}}return i},transform(t,e){var i=new ImageData(e.plotWidth,e.plotHeight),a=i.data,s=new Uint32Array(a.buffer),o=t.data,r=new Uint32Array(o.buffer),n=this._map.getZoom(),h=this._map.options.crs.scale(n),l=57.29577951308232,m=this._map.options.crs.transformation._a,d=this._map.options.crs.transformation._b,p=this._map.options.crs.transformation._c,u=this._map.options.crs.transformation._d;L.version>="1.0"&&(m*=this._map.options.crs.projection.R,p*=this._map.options.crs.projection.R);for(var g=0;g<e.plotHeight;g++)for(var c=((e.yOrigin+g)/h-u)/p,_=(2*Math.atan(Math.exp(c))-Math.PI/2)*l,f=this.raster.height-Math.ceil((_-this._rasterBounds._southWest.lat)/e.latSpan),x=0;x<e.plotWidth;x++){var y=g*e.plotWidth+x,B=((e.xOrigin+x)/h-d)/m*l,w=Math.floor((B-this._rasterBounds._southWest.lng)/e.lngSpan),v=f*this.raster.width+w;s[y]=r[v]}return i},getDescendantProp(t,e){const i=e.split(".");for(;i.length&&(t=t[i.shift()]););return t}}),L.LeafletGeotiffRenderer=L.Class.extend({initialize(t){L.setOptions(this,t)},setParent(t){this.parent=t},render(t,e,i,a){throw new Error("Abstract class")}}),L.leafletGeotiff=function(t,e){return new L.LeafletGeotiff(t,e)}}));
//# sourceMappingURL=/sm/392035ee5db25b8c8e0c45fa5934d62b58c2f3a1671d1afc6f6804d995d32ed5.map